@startuml activity_build_risk_evaluation
!theme plain
title Activity Diagram - Build Risk Evaluation Process

start

:Trigger: New build detected;
note right
  From GitHub Actions workflow
  or manual trigger
end note

:Fetch build metadata from GitHub;
note right
  Build ID
  Status (pass/fail)
  Timestamps
  Commit info
  Test results
end note

:Store raw build record in MongoDB;

:Initialize feature extraction pipeline;

:Execute DAG nodes for feature extraction;

partition "Feature Extraction (Parallel)" {
    :Extract Git features;
    note right
      Commit author
      Files changed
      Code churn
      Team membership
    end note
    
    :Extract GitHub features;
    note right
      Code changes
      Diff statistics
      Contributor metrics
    end note
    
    :Extract build log features;
    note right
      Test results
      Test coverage
      Job duration
      Framework-specific logs
    end note
    
    :Extract SonarQube features;
    note right
      Code coverage
      Code smells
      Technical debt
      Security issues
    end note
}

:Combine all extracted features;

:Create feature vector;

:Validate feature completeness;

if (All required features available?) then (yes)
    :Proceed to inference;
else (no)
    :Use default/fallback values;
    note right
      Log missing features
      Mark as partial data
    end note
endif

:Load trained Bayesian model;

:Run model inference;

:Model produces outputs;
note right
  Risk classification:
  - Low
  - Medium
  - High
  
  Risk score (0-1)
  Uncertainty estimate
end note

:Store prediction in MongoDB;

:Create result record;
note right
  Build ID
  Features used
  Predicted risk level
  Risk score
  Uncertainty
  Timestamp
end note

if (WebSocket connected?) then (yes)
    :Send real-time notification to frontend;
else (no)
    :Queue notification for next poll;
endif

:Update dashboard cache;

:Log evaluation metrics;

:End evaluation process;

stop

@enduml
