# ============================================
# Build Risk Dashboard - Backend Configuration
# ============================================

# ----------------------
# Application
# ----------------------
# Environment: dev, staging, prod
ENV=dev
DEBUG=True
SECRET_KEY=your-super-secret-key-change-in-production

# ----------------------
# Database (MongoDB)
# ----------------------
MONGODB_URI=mongodb://localhost:27017
MONGODB_DB_NAME=buildguard

# ----------------------
# Celery / RabbitMQ / Redis
# ----------------------
CELERY_BROKER_URL=amqp://myuser:mypass@localhost:5672//
CELERY_RESULT_BACKEND=redis://localhost:6379/0
REDIS_URL=redis://localhost:6379/0
CELERY_DEFAULT_QUEUE=pipeline.default
CELERY_TASK_SOFT_TIME_LIMIT=600
CELERY_TASK_TIME_LIMIT=900
CELERY_BROKER_HEARTBEAT=30

# ----------------------
# GitHub OAuth & App
# ----------------------
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_REDIRECT_URI=http://localhost:8000/api/auth/github/callback
GITHUB_WEBHOOK_SECRET=your-webhook-secret
GITHUB_APP_ID=your-github-app-id
GITHUB_APP_PRIVATE_KEY=/path/to/your/github-app-private-key.pem
GITHUB_INSTALLATION_ID=your-github-app-installation-id
GITHUB_TOKENS=[]
GITHUB_SCOPES=["read:user","user:email","repo","read:org","workflow"]
FRONTEND_BASE_URL=http://localhost:3000

# ----------------------
# RBAC / Organization Access
# ----------------------
# GitHub organization name for membership verification
# Only users who are members of this organization can access the system
GITHUB_ORGANIZATION=your-github-org-name
# Set to false to disable org membership check (allow any GitHub user)
REQUIRE_ORG_MEMBERSHIP=true

# For "Sign in with Google" (Guest) AND Gmail API Authorization
# Default values are already set in config.py, but you can override them here
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:8000/api/auth/google/callback

# Gmail API Integration (for sending invites)
# Paste the content of your gmail_token.json here (minified) within single quotes
# Default value is already set in config.py
GMAIL_TOKEN_JSON='{"token": "", "refresh_token": "", "token_uri": "https://oauth2.googleapis.com/token", "client_id": "", "client_secret": "", "scopes": ["https://www.googleapis.com/auth/gmail.send"], "universe_domain": "googleapis.com", "account": "", "expiry": ""}'

# Set to true to enable Gmail API (only works if above vars are set)
GMAIL_NOTIFICATIONS_ENABLED=true

# Optional: Setup for SMTP fallback if API fails
# GMAIL_USER=your-email@gmail.com
# GMAIL_APP_PASSWORD=your-16-char-app-password

# ----------------------
# SonarQube (Optional)
# ----------------------
SONAR_HOST_URL=http://localhost:9000
SONAR_TOKEN=
SONAR_DEFAULT_PROJECT_KEY=build-risk-ui
SONAR_WEBHOOK_SECRET=change-me

# Trivy Security Scanner
TRIVY_SERVER_URL=

# ==========================================================================
# Pipeline Batch Processing
# ==========================================================================

# --- Ingestion Phase ---
INGESTION_BUILDS_PER_PAGE=20
INGESTION_WORKTREES_PER_CHUNK=50
INGESTION_LOGS_PER_CHUNK=100

# --- Processing Phase ---
PROCESSING_BUILDS_PER_BATCH=50

# --- Validation Phase ---
VALIDATION_CSV_CHUNK_SIZE=10000
VALIDATION_REPOS_PER_TASK=20
VALIDATION_BUILDS_PER_TASK=500
VALIDATION_RATE_LIMIT=10/s

# --- Git/Log Constraints ---
GIT_MAX_LOG_SIZE_MB=10
GIT_COMMIT_REPLAY_MAX_DEPTH=50
GIT_LOG_UNAVAILABLE_THRESHOLD=10

# --- Rate Limiting (GitHub API) ---
GITHUB_API_RATE_PER_SECOND=10.0
GITHUB_API_BURST_ALLOWANCE=5

# --- CSV Dataset Limits ---
CSV_MAX_FILE_SIZE_MB=50
CSV_MAX_ROWS=100000
CSV_MIN_ROWS=1
CSV_BATCH_PROGRESS_INTERVAL=100
CSV_DUPLICATE_WARN_THRESHOLD=0.1
CSV_MISSING_WARN_THRESHOLD=0.05

# --- Hamilton Pipeline Caching ---
HAMILTON_CACHE_ENABLED=true
HAMILTON_CACHE_TYPE=file

# ----------------------
# GitLab CI (Optional)
# ----------------------
# GITLAB_TOKEN=your-gitlab-personal-access-token
# GITLAB_BASE_URL=https://gitlab.com/api/v4

# ----------------------
# CircleCI (Optional)
# ----------------------
# CIRCLECI_TOKEN=your-circleci-personal-api-token
# CIRCLECI_BASE_URL=https://circleci.com/api/v2

# ----------------------
# Travis CI (Optional)
# ----------------------
# TRAVIS_TOKEN=your-travis-api-token
# TRAVIS_BASE_URL=https://api.travis-ci.com